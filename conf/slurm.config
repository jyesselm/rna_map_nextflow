/*
 * SLURM cluster execution profile
 * 
 * Use this profile for running on a SLURM cluster.
 * 
 * Usage:
 *   nextflow run main.nf -profile slurm --fasta ref.fasta --fastq1 reads.fastq
 * 
 * Customize queueSize to control batching:
 *   - Low queueSize (1-5): Submit immediately, good for slow/long tasks
 *   - High queueSize (10-50): Batch tasks together, reduces submission overhead
 */

process {
    executor = 'slurm'
    
    // Default resource limits
    cpus = { task.cpus ?: 4 }
    memory = { task.memory ?: '8 GB' }
    time = { task.time ?: '2h' }
    
    // SLURM-specific settings
    clusterOptions = ""
    
    // Queue size - controls task batching
    // Higher = more batching = fewer job submissions (good for fast tasks)
    // Lower = less batching = more immediate submission (good for slow tasks)
    queueSize = params.queue_size ?: 10
    
    // Resource limits
    maxForks = params.max_cpus ?: 16
    maxRetries = 3
    errorStrategy = 'retry'
    
    // Process-specific queue sizes
    withLabel: 'process_low' {
        queueSize = 20  // Batch many fast tasks
    }
    
    withLabel: 'process_medium' {
        queueSize = 10  // Moderate batching
    }
    
    withLabel: 'process_high' {
        queueSize = 5   // Less batching for slower tasks
    }
    
    // Custom label for very slow tasks
    withLabel: 'process_slow' {
        queueSize = 1   // Submit immediately - no batching
    }
}

// Include base configuration
includeConfig "${baseDir}/conf/base.config"
