/*
 * SLURM Hybrid Profile - Mixed fast and slow tasks
 * 
 * This profile uses queue-based optimization for different task types.
 * Fast tasks are batched together, slow tasks are submitted immediately.
 * 
 * Usage:
 *   nextflow run main.nf -profile slurm_hybrid --fasta ref.fasta --fastq1 reads.fastq
 */

process {
    // Use SLURM executor
    executor = 'slurm'
    
    // Default resource limits
    cpus = { task.cpus ?: 4 }
    memory = { task.memory ?: '8 GB' }
    time = { task.time ?: '2h' }
    
    clusterOptions = ""
    
    // Queue optimization - batch fast tasks, submit slow tasks immediately
    queueSize = 10
    maxForks = params.max_cpus ?: 16
    pollInterval = '10s'
    
    maxRetries = 3
    errorStrategy = 'retry'
    
    // Fast tasks: batch together to reduce overhead
    withLabel: 'process_low' {
        cpus = 2
        memory = '4 GB'
        time = '1h'
        queueSize = 20  // Batch many fast tasks
    }
    
    withLabel: 'process_medium' {
        cpus = 4
        memory = '8 GB'
        time = '2h'
        queueSize = 10  // Moderate batching
    }
    
    // Slow tasks: less batching
    withLabel: 'process_high' {
        cpus = { params.max_cpus ?: 16 }
        memory = { params.max_memory ?: '32 GB' }
        time = { params.max_time ?: '24h' }
        queueSize = 5  // Less batching for slower tasks
    }
    
    // Very slow tasks: submit immediately
    withLabel: 'process_slow' {
        cpus = { params.max_cpus ?: 16 }
        memory = { params.max_memory ?: '64 GB' }
        time = { params.max_time ?: '48h' }
        queueSize = 1  // No batching - submit immediately
    }
}

// Include base configuration
includeConfig "${baseDir}/conf/base.config"
